(()=>{"use strict";class t{constructor(t){this.game=t,this.markedForDeletion=!1}update(){this.size&&this.x&&this.speedX&&this.speedY&&this.y&&(this.x-=this.speedX+this.game.speed,this.y-=this.speedY,this.size*=.95,this.size<.5&&(this.markedForDeletion=!0))}}class e extends t{constructor(t,e,i){super(t),this.size=10*Math.random()+10,this.x=e,this.y=i,this.speedX=Math.random(),this.speedY=Math.random(),this.color="rgba(0,0,0,0.2)"}draw(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()}}class i extends t{constructor(t,e,i){super(t),this.size=100*Math.random()+100,this.x=e-.4*this.size,this.y=i-.5*this.size,this.speedX=6*Math.random()-4,this.speedY=2*Math.random()+2,this.gravity=0,this.image=document.getElementById("fire")}update(){super.update(),this.gravity+=.1,this.y&&(this.y+=this.gravity)}draw(t){this.x&&this.y&&this.size&&t.drawImage(this.image,this.x,this.y,this.size,this.size)}}class s extends t{constructor(t,e,i){super(t),this.image=document.getElementById("fire"),this.size=100*Math.random()+50,this.x=e-.4*this.size,this.y=i-.5*this.size,this.speedX=1,this.speedY=1,this.angle=0,this.va=.2*Math.random()-.1}update(){super.update(),this.angle+=this.va,this.x&&(this.x+=Math.sin(5*this.angle))}draw(t){this.x&&this.y&&this.size&&(t.save(),t.translate(this.x,this.y),t.rotate(this.angle),t.drawImage(this.image,.5*-this.size,.5*-this.size,this.size,this.size),t.restore())}}class h{constructor(t,e){this.state=t,this.game=e}}class a extends h{constructor(t){super("SITTING",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=4,this.game.player.frameY=5}handleInput(t){t.includes("ArrowLeft")||t.includes("ArrowRight")?this.game.player.setState(1,1):t.includes("Enter")&&this.game.player.setState(4,2)}}class r extends h{constructor(t){super("RUNNING",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=8,this.game.player.frameY=3}handleInput(t){this.game.particles.unshift(new e(this.game,this.game.player.x+.5*this.game.player.width,this.game.player.y+this.game.player.height)),t.includes("ArrowDown")?this.game.player.setState(0,0):t.includes("ArrowUp")?this.game.player.setState(2,1):t.includes("Enter")&&this.game.player.setState(4,2)}}class m extends h{constructor(t){super("JUMPING",t)}enter(){this.game.player.onGround()&&(this.game.player.vy-=27),this.game.player.frameX=0,this.game.player.maxFrame=6,this.game.player.frameY=1}handleInput(t){this.game.player.vy>this.game.player.weight?this.game.player.setState(3,1):t.includes("Enter")?this.game.player.setState(4,2):t.includes("ArrowDown")&&this.game.player.setState(5,0)}}class n extends h{constructor(t){super("FALLING",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=8,this.game.player.frameY=2}handleInput(t){this.game.player.onGround()?this.game.player.setState(1,1):t.includes("ArrowDown")&&this.game.player.setState(5,0)}}class g extends h{constructor(t){super("ROLLING",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=6,this.game.player.frameY=6}handleInput(t){this.game.particles.unshift(new s(this.game,this.game.player.x+.5*this.game.player.width,this.game.player.y+.5*this.game.player.height)),!t.includes("Enter")&&this.game.player.onGround()?this.game.player.setState(1,1):t.includes("Enter")||this.game.player.onGround()?t.includes("Enter")&&t.includes("ArrowUp")&&this.game.player.onGround()?this.game.player.vy-=27:t.includes("ArrowDown")&&!this.game.player.onGround()&&this.game.player.setState(5,0):this.game.player.setState(3,1)}}class d extends h{constructor(t){super("DIVING",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=6,this.game.player.frameY=6,this.game.player.vy=15}handleInput(t){if(this.game.particles.unshift(new s(this.game,this.game.player.x+.5*this.game.player.width,this.game.player.y+.5*this.game.player.height)),this.game.player.onGround()){this.game.player.setState(1,1);for(let t=0;t<30;t++)this.game.particles.unshift(new i(this.game,this.game.player.x+.5*this.game.player.width,this.game.player.y+this.game.player.height))}else t.includes("Enter")&&this.game.player.onGround()&&this.game.player.setState(4,2)}}class l extends h{constructor(t){super("HIT",t)}enter(){this.game.player.frameX=0,this.game.player.maxFrame=10,this.game.player.frameY=4}handleInput(t){this.game.player.frameX>=10&&this.game.player.onGround()?this.game.player.setState(1,1):this.game.player.frameX>=10&&!this.game.player.onGround()&&this.game.player.setState(3,2)}}class o{constructor(t,e,i){this.game=t,this.image=document.getElementById("collisionAnimation"),this.spriteWidth=100,this.spriteHeight=90,this.sizeModifier=Math.random()+.5,this.width=this.spriteWidth*this.sizeModifier,this.height=this.spriteHeight*this.sizeModifier,this.x=e-.5*this.width,this.y=i-.5*this.height,this.frameX=0,this.maxFrame=4,this.markedForDeletion=!1,this.fps=10*Math.random()+5,this.frameInterval=1e3/this.fps,this.frameTimer=0}draw(t){t.drawImage(this.image,this.frameX*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}update(t){this.x-=this.game.speed,this.frameTimer>this.frameInterval?(this.frameX++,this.frameTimer=0):this.frameTimer+=t,this.frameX>this.maxFrame&&(this.markedForDeletion=!0)}}class y{constructor(t){this.game=t,this.width=100,this.height=91.3,this.x=0,this.y=this.game.height-this.height-this.game.groundMargin,this.vy=0,this.weight=1,this.image=document.getElementById("player"),this.frameX=0,this.frameY=0,this.maxFrame=0,this.fps=20,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.speed=0,this.maxSpeed=4,this.states=[new a(this.game),new r(this.game),new m(this.game),new n(this.game),new g(this.game),new d(this.game),new l(this.game)]}update(t,e){this.checkCollision(),this.currentState&&this.currentState.handleInput(t),this.x+=this.speed,t.includes("ArrowRight")&&this.currentState!==this.states[6]?this.speed=this.maxSpeed:t.includes("ArrowLeft")&&this.currentState!==this.states[6]?this.speed=-this.maxSpeed:this.speed=0,this.x<0&&(this.x=0),this.x>this.game.width-this.width&&(this.x=this.game.width-this.width),this.y+=this.vy,this.onGround()?this.vy=0:this.vy+=this.weight,this.y>this.game.height-this.height-this.game.groundMargin&&(this.y=this.game.height-this.height-this.game.groundMargin),this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX<this.maxFrame?this.frameX++:this.frameX=0):this.frameTimer+=e}draw(t){this.game.debug&&t.strokeRect(this.x,this.y,this.width,this.height),t.drawImage(this.image,this.frameX*this.width,this.frameY*this.height,this.width,this.height,this.x,this.y,this.width,this.height)}onGround(){return this.y>=this.game.height-this.height-this.game.groundMargin}setState(t,e){this.currentState=this.states[t],this.game.speed=this.game.maxSpeed*e,this.currentState&&this.currentState.enter()}checkCollision(){this.game.enemies.forEach((t=>{t.x&&t.y&&t.width&&t.height&&t.x<this.x+this.width&&t.x+t.width>this.x&&t.y<this.y+this.height&&t.y+t.height>this.y&&(t.markedForDeletion=!0,this.game.collisions.push(new o(this.game,t.x+.5*t.width,t.y+.5*t.height)),this.currentState===this.states[4]||this.currentState===this.states[5]?this.game.score++:this.setState(6,0))}))}}class p{constructor(t){this.keys=[],this.game=t,window.addEventListener("keydown",(t=>{"ArrowDown"!==t.key&&"ArrowUp"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowEnter"!==t.key&&"Enter"!==t.key||-1!==this.keys.indexOf(t.key)?"d"===t.key&&(this.game.debug=!this.game.debug):this.keys.push(t.key)})),window.addEventListener("keyup",(t=>{"ArrowDown"!==t.key&&"ArrowUp"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowEnter"!==t.key&&"Enter"!==t.key||this.keys.splice(this.keys.indexOf(t.key),1)}))}}class c{constructor(t,e,i,s,h){this.game=t,this.width=e,this.height=i,this.speedModifier=s,this.image=h,this.x=0,this.y=0}update(){this.x<-this.width?this.x=0:this.x-=this.game.speed*this.speedModifier}draw(t){t.drawImage(this.image,this.x,this.y,this.width,this.height),t.drawImage(this.image,this.x+this.width,this.y,this.width,this.height)}}class u{constructor(t){this.game=t,this.width=1667,this.height=500,this.layer1image=document.getElementById("layer1"),this.layer2image=document.getElementById("layer2"),this.layer3image=document.getElementById("layer3"),this.layer4image=document.getElementById("layer4"),this.layer5image=document.getElementById("layer5"),this.layer1=new c(this.game,this.width,this.height,0,this.layer1image),this.layer2=new c(this.game,this.width,this.height,.2,this.layer2image),this.layer3=new c(this.game,this.width,this.height,.4,this.layer3image),this.layer4=new c(this.game,this.width,this.height,.8,this.layer4image),this.layer5=new c(this.game,this.width,this.height,2,this.layer5image),this.backgroundLayers=[this.layer1,this.layer2,this.layer3,this.layer4,this.layer5]}update(){this.backgroundLayers.forEach((t=>{t.update()}))}draw(t){this.backgroundLayers.forEach((e=>{e.draw(t)}))}}class w{constructor(){this.frameX=0,this.frameY=0,this.maxFrame=3,this.fps=20,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.markedForDeletion=!1}update(t){this.x&&(this.x-=this.game&&this.speedX+this.game.speed||0),this.y+=this.speedY,this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX<this.maxFrame?this.frameX++:this.frameX=0):this.frameTimer+=t,this.width&&this.x&&this.x+this.width<0&&(this.markedForDeletion=!0)}draw(t){this.game&&this.x&&this.y&&this.width&&this.height&&this.game.debug&&t.strokeRect(this.x,this.y,this.width,this.height),this.image&&this.width&&this.height&&this.x&&this.y&&t.drawImage(this.image,this.frameX*this.width,0,this.width,this.height,this.x,this.y,this.width,this.height)}}class f extends w{constructor(t){super(),this.game=t,this.width=60,this.height=44,this.x=this.game.width+Math.random()*this.game.width*.5,this.y=Math.random()*this.game.height*.5,this.speedX=Math.random()+1,this.speedY=0,this.maxFrame=5,this.image=document.getElementById("enemy_fly"),this.angle=0,this.va=.1*Math.random()+.1}update(t){super.update(t),this.angle+=this.va,this.y&&(this.y+=Math.sin(this.angle))}}class x extends w{constructor(t){super(),this.game=t,this.width=60,this.height=87,this.x=this.game.width,this.y=this.game.height-this.height-this.game.groundMargin,this.image=document.getElementById("enemy_plant"),this.speedX=0,this.speedY=0,this.maxFrame=1}}class k extends w{constructor(t){super(),this.game=t,this.width=120,this.height=144,this.x=this.game.width,this.y=Math.random()*this.game.height*.5,this.image=document.getElementById("enemy_spider_big"),this.speedX=0,this.speedY=Math.random()>.5?1:-1,this.maxFrame=5}update(t){var e;super.update(t),this.y&&this.game&&this.y>(null===(e=this.game)||void 0===e?void 0:e.height)-this.game.groundMargin&&(this.speedY*=-1),this.y&&this.height&&this.y<-this.height&&(this.markedForDeletion=!0)}draw(t){this.x&&this.y&&this.width&&(super.draw(t),t.beginPath(),t.moveTo(this.x+this.width/2,0),t.lineTo(this.x+this.width/2,this.y+50),t.stroke())}}class I{constructor(t){this.game=t,this.fontSize=30,this.fontFamily="Helvetica"}draw(t){t.save(),t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowColor="white",t.shadowBlur=0,t.font=this.fontSize+"px "+this.fontFamily,t.textAlign="left",t.fillStyle=this.game.fontColor,t.fillText("Score: "+this.game.score,20,50),t.font=.8*this.fontSize+"px "+this.fontFamily,t.fillText("Time: "+(.001*this.game.time).toFixed(1),20,80),this.game.gameOver&&(t.textAlign="center",t.font=2*this.fontSize+"px "+this.fontFamily,this.game.score>5?(t.fillText("Time Over ",.5*this.game.width,.5*this.game.height-20),t.font=.7*this.fontSize+"px "+this.fontFamily,t.fillText(" ",.5*this.game.width,.5*this.game.height+20)):(t.fillText("Love at first bite? ",.5*this.game.width,.5*this.game.height-20),t.font=.7*this.fontSize+"px "+this.fontFamily,t.fillText("Nope, better luck next time ! ",.5*this.game.width,.5*this.game.height+20))),t.restore()}}const S=document.getElementById("canvas"),v=S.getContext("2d");S.width=500,S.height=500;const E=new class{constructor(t,e){this.width=t,this.height=e,this.groundMargin=80,this.speed=0,this.maxSpeed=3,this.player=new y(this),this.background=new u(this),this.input=new p(this),this.UI=new I(this),this.enemies=[],this.particles=[],this.collisions=[],this.maxParticles=50,this.enemyTimer=0,this.enemyInterval=1e3,this.debug=!1,this.score=0,this.fontColor="black",this.time=0,this.maxTime=2e5,this.gameOver=!1,this.player.currentState=this.player.states[0],this.player.currentState.enter()}update(t){this.time+=t,this.time>this.maxTime&&(this.gameOver=!0),this.background.update(),this.player.update(this.input.keys,t),this.enemyTimer>this.enemyInterval?(this.addEnemy(),this.enemyTimer=0):this.enemyTimer+=t,this.enemies.forEach((e=>{e.update(t),e.markedForDeletion&&this.enemies.splice(this.enemies.indexOf(e),1)})),this.particles.forEach(((t,e)=>{t.update(),t.markedForDeletion&&this.particles.splice(e,1)})),this.particles.length>this.maxParticles&&(this.particles.length=this.maxParticles),this.collisions.forEach(((e,i)=>{e.update(t),e.markedForDeletion&&this.collisions.splice(i,1)}))}draw(t){this.background.draw(t),this.player.draw(t),this.enemies.forEach((e=>{e.draw(t)})),this.particles.forEach((h=>{(h instanceof e||h instanceof s||h instanceof i)&&h.draw(t)})),this.collisions.forEach((e=>{e instanceof o&&e.draw(t)})),this.UI.draw(t)}addEnemy(){this.speed>0&&Math.random()<.5?this.enemies.push(new f(this)):this.speed>0&&this.enemies.push(new k(this)),this.enemies.push(new x(this))}}(S.width,S.height);let F=0;!function t(e){const i=e-F;F=e,v.clearRect(0,0,S.width,S.height),E.update(i),E.draw(v),E.gameOver||requestAnimationFrame(t)}(0)})();